@{
    Layout = "~/Views/Shared/_CampaignLayout.cshtml";
    ViewBag.Title = "ReportGroupSummary";
}

<style>
    .table > thead > tr > th {
        word-wrap: break-word;
        padding: 5px 0 5px 0;
        margin: 0px;
        text-align: center;
        vertical-align: middle;
        font-size: small;
    }

    .table > tbody > tr > td {
        text-align: right;
        vertical-align: middle;
        padding: 3px;
        font-weight: 600;
        font-size: small;
    }

        .table > tbody > tr > td > input {
            text-align: right;
            vertical-align: central;
        }
</style>
<div class="row">
    <input type="hidden" id="rcode" value="@ViewBag.rcode" />
    <div class ="col-lg-12">
        <div class="box">
            <div class ="box-content">
                @using (Html.BeginForm("ReportGroupSummary", "Report", FormMethod.Post, new { @class = "form-horizontal" }))
                {
                @Html.ValidationSummary(true)
                <fieldset  class ="col-sm-12">
                <div class="row">
                    <div class="col-lg-12">	
                        <div class="box">
                            <table style ="width: 100%;margin-top:3px;margin-bottom:3px;">
                                <tr>
                                    <td ><b>Campaign</b><br />@Html.DropDownList("cbocampaign",new SelectList(@ViewBag.CampaignOptions,"id","gamedesc"), new { @class ="form-control",@id="cbocampaign",@name="cbocampaign"})</td>                                                             
                                    <td style="width:10%;"></td>    
                                    <td ><b>Group</b><br />@Html.DropDownList("cbogroup", new SelectList(@ViewBag.GroupOptions, "Value", "Text"), new { @class = "form-control", @id = "cbogroup", @name = "cbogroup" })</td>
                                    <td style="width:10%;"></td>
                                    <td style="width:10%;"><b>Date</b><br/><div class="controls"><input type="text" id="cdate" class="form-control date-picker" data-date-format="dd/mm/yyyy" value="@string.Format("{0:d}",DateTime.Today)" />@*<input type="text" class="form-control datepicker" id="datepicker" name="datepicker" value=""/>*@</div></td>                                    
                                    <td style="width:10%;"><b>Time</b><br/>@Html.DropDownList("cbotime", new SelectList(@ViewBag.TimeOptions, "Value", "Text"), new { @class = "form-control", @id = "cbotime", @name = "cbotime" })</td>
                                    <td style="width:10%;"></td>
                                    <td></td>                                    
                                </tr>
                                <tr>
                                    <td colspan="5"></td>
                                    <td> <button class="btn btn-primary" id="btnSearch" name ="btnSearch" type="button" style ="width:100%">Search</button></td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>
                                        
                                    </td>
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>
                                        
                                    </td>
                                </tr>
                            </table>
                      </div>
                </div>
            </div> @*row*@

                <div class="row">
                    <div class="col-lg-12">	
                        <div class="box">
                            <table>
                                <tr>
                                    <td style ="width:50px;"><input style="background-color: white; padding-top: 0px; padding-right: 0px; width: 50px;" class="form-control" value="" disabled/> </td>
                                    <td>Actual</td>
                                    <td style="width:30px;"></td>
                                    <td style ="width:50px;"><input style="background-color:#EEE;padding-top:0px;padding-right:0px;width:50px;" type="text" class="form-control" value="" disabled /> </td>
                                    <td>Forecast</td>
                                </tr>
                            </table>    
                        </div>
                    </div>                 
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="box">
                            <div class="box-header" data-original-title>
                                <h2><i class="fa fa-group"></i><span class="break"></span>Group Sales & Activity Summary Report</h2>
                                <div class="box-icon">
                                    <a href="#" class="btn-setting"><i class="fa fa-wrench"></i></a>
                                    <a href="#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
                                    <a href="#" class="btn-close"><i class="btn-close"></i></a>
                                </div>
                            </div>
                            <div class="box-content">
                                <div id="divReportSummary"></div>
                            </div> @*box-content*@
                        </div> @*box*@
                    </div><!--/row-->

                </div> @*row*@

                <div class="row">
                	<div class="col-lg-12">					
					    <div class="box">
						    <div class="box-header" data-original-title>
							    <h2><i class="fa fa-group"></i><span class="break"></span>Branch Sales & Activity  Report</h2>
							    <div class="box-icon">
								    <a href="#" class="btn-setting"><i class="fa fa-wrench"></i></a>
								    <a href="#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								    <a href="#" class="btn-close"><i class="btn-close"></i></a>
							    </div>
						    </div>
						    <div class="box-content">            
                                <div id ="divReportDetail"></div>
                            </div> @*box-content*@                        
                        </div> @*box*@		
			    </div><!--/row-->
                    	
                </div> @*row*@

                    <div class="row">
                        <div class="col-lg-12">
                            <div class="box">
                                <div class="box-header" data-original-title>
                                    <h2><i class="fa fa-group"></i><span class="break"></span>Staff Sales & Activity  Report</h2>
                                    <div class="box-icon">
                                        <a href="#" class="btn-setting"><i class="fa fa-wrench"></i></a>
                                        <a href="#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
                                        <a href="#" class="btn-close"><i class="btn-close"></i></a>
                                    </div>
                                </div>
                                <div class="box-content">
                                    <div id="divReportStaff"></div>
                                </div> @*box-content*@
                            </div> @*box*@
                        </div><!--/row-->

                    </div>
                </fieldset>
                }
            </div>
        </div> @*box*@
    </div>
</div>@*row*@

<div class="row">
    <div class="col-lg-12">
        <div class="box">

            <div class="col-sm-2">
                <a class="quick-button" href="~/Access/BranchStaffIndex">
                    <i class="fa fa-user"></i>
                    <p>Home</p>
                </a>
            </div>
            <div class="col-sm-2">
                <a class="quick-button" href="#" onclick="reCalculate();">
                    <i class="fa fa-user"></i>
                    <p>Recalculate Sales Figure</p>
                </a>
            </div>

        </div>
    </div>
</div>

<script type ="text/javascript">
    //$("#datepicker").datepicker({ dateFormat: "dd/mm/yy" });
    var today = new Date();    
    //$("#datepicker").datepicker("setDate", today);

    $('#btnSearch').click(function e() {
        populateGroupSummary();
        populateBranchSummary();        
        populateStaffSummary();
    });
    function populateBranchSummary() {
        //alert("populateCampaignDetail");
        //alert(t);
        
        var cid = $('#cbocampaign').val();
        //var bid = $('#cbobranch').val();
        var gid = $('#cbogroup').val();
        var t = $('#cbotime').val();
        var d = $('#cdate').val();//$('#datepicker').datepicker("getDate");

        //alert('Populate Detail' + $('#datepicker').val());
        //alert(d);
        //alert($.format.date(d, "dd/mm/yyyy"));

        //alert("populateCampaignDetail");
        $.ajax({
            url: '@Url.Action("getBranchSalesReportGrid", "Report")',
            data: { campaignid: cid, groupid: gid, time: t, cdate: d },
            type: 'POST',
            success: function (data) {
                //alert(data);                
                    $('#divReportDetail').html(data);
            }
        });

    }

    function populateGroupSummary() {
        //alert("populateCampaignDetail");
        //alert(t);

        var cid = $('#cbocampaign').val();
        //var bid = $('#cbobranch').val();
        var gid = $('#cbogroup').val();
        var t = $('#cbotime').val();
        var d = $('#cdate').val();//$('#datepicker').datepicker("getDate");

        //alert('Populate Detail' + $('#datepicker').val());
        //alert(d);
        //alert($.format.date(d, "dd/mm/yyyy"));

        //alert("populateCampaignDetail");
        $.ajax({
            url: '@Url.Action("getGroupSalesReportGrid", "Report")',
            data: { campaignid: cid, groupid: gid, time: t, cdate: d },
            type: 'POST',
            success: function (data) {
                //alert(data);                
                $('#divReportSummary').html(data);
            }
        });

    }

    function populateStaffSummary() {
        //alert("populateCampaignDetail");
        //alert(t);

        var cid = $('#cbocampaign').val();
        //var bid = $('#cbobranch').val();
        var gid = $('#cbogroup').val();
        var t = $('#cbotime').val();
        var d = $('#cdate').val();//$('#datepicker').datepicker("getDate");

        //alert('Populate Detail' + $('#datepicker').val());
        //alert(d);
        //alert($.format.date(d, "dd/mm/yyyy"));

        //alert("populateCampaignDetail");
        $.ajax({
            url: '@Url.Action("getBranchStaffReportGrid", "Report")',
            data: { campaignid: cid, groupid: gid, time: t, cdate: d },
            type: 'POST',
            success: function (data) {
                //alert(data);                
                $('#divReportStaff').html(data);
            }
        });

    }

    function reCalculate() {
        var cid = $('#cbocampaign').val();
        //var bid = $('#cbobranch').val();
        var gid = $('#cbogroup').val();
        //var t = $('#cbotime').val();
        var d = $('#cdate').val();

        //alert('call recal');
        $.ajax({
            url: '@Url.Action("recalculateSaleFigure", "Campaign")',
            data: JSON.stringify({ campaigndate: d, gid: gid, bcode: "ALL", campaignid: cid, resource: $('#rcode').val() }),
            type: 'POST',
            dataType: "json",
            contentType: "application/json; charset=utf-8",
            success: function (data) {
                //alert("Successfully Saved!");
                if (data == "SUCCESS") alert("Successfully Saved!");
                //populateCampaignDetail($('#cbocampaign').val(), $('#cbobranch').val(), $('#cbogroup').val(), $('#cbotime').val());
            },
            error: function (req, status, err) {
                alert(err);
            }
        });
    }
</script>