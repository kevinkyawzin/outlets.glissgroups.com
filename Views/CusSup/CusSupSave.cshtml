@model BigMac.Models.CusSup_m_CusSup

@{
    ViewBag.Title = "Customer/Supplier Entry";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

    <div class="row">
        <div class ="col-lg-12">
            <div class="box">
                <div class ="box-header">
							<h2><i class="fa fa-edit"></i>@Model.cussuptype Entry</h2>
							<div class="box-icon">
								<a href="#" class="btn-setting"><i class="fa fa-wrench"></i></a>
								<a href="#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
                </div>
                <div class ="box-content">
                @using (Html.BeginForm("CusSupSave","CusSup",FormMethod.Post)) 
                {
                    @Html.HiddenFor(model => model.id) 
                    @Html.ValidationSummary(true)
                    <fieldset  class ="col-sm-12">
                        <table style="width:100%;border-spacing:5px;border-collapse:separate;">
                            <tr>
                                <td style="width:15%;"><label class="control-label" >@Html.LabelFor(model => model.cussupname)</label></td>
                                <td style="width:30%;">
		                            <div class="form-group">			            
			                            <div class="controls row">                                            
				                             @Html.TextBoxFor(model => model.cussupname, new { @class ="form-control"})                                                                
                                            <span>@Html.ValidationMessageFor(model => model.cussupname)	</span>	
			                            </div>
		                            </div>
                                </td>
                                <td style="width:5%;"></td>
                                <td style="width:15%;"><label class="control-label" >@Html.LabelFor(model => model.cocode)</label></td>
                                <td style="width:30%;">
					                <div class="form-group">						                
						                <div class="controls row">                                            
                                           @Html.DropDownListFor(model => model.cocode, new SelectList(@ViewBag.CompanyOptions,"id","name"), new { @class ="form-control"})                                            
						                </div>
					                </div>
                                </td>
                                <td style="width:5%;"></td>
                            </tr>
                            <tr>
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.nric)</label></td>
                                <td>
		                            <div class="form-group">			                            
			                            <div class="controls row">                                            
				                                @Html.TextBoxFor(model => model.nric, new { @class ="form-control"})                                            
                                                <span>@Html.ValidationMessageFor(model => model.nric)</span>	    
			                            </div>
		                            </div>
                                </td>
                                <td style="width:10%;"></td>
                                <td style="width:15%;"><label class="control-label" >@Html.LabelFor(model => model.branchcode)</label></td>
                                <td style="width:30%;">
					                <div class="form-group">						                
						                <div class="controls row">                                            
                                            @Html.DropDownListFor(model => model.branchcode, new SelectList(@ViewBag.BranchOptions,"id","branchname"), new { @class ="form-control"})                                           
						                </div>
					                </div>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.dateofbirth)</label></td>
                                <td>
		                            <div class="form-group">
			                            <div class="controls row">                                            
                                                @Html.TextBoxFor(model => model.email, new { @class ="form-control"})                                                                                    
                                                <span>@Html.ValidationMessageFor(model => model.email)</span>	
			                            </div>
		                            </div>
                                </td>
                                <td></td>
                                <td ><label class="control-label" >@Html.LabelFor(model => model.inhousecode)</label></td>
                                <td>
		                            <div class="form-group">			            
			                            <div class="controls row">                            
				                                @Html.TextBoxFor(model => model.inhousecode, new { @class ="form-control"})                    
                                            <span>@Html.ValidationMessageFor(model => model.inhousecode)</span>	
			                            </div>
		                            </div>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.email)</label></td>
                                <td>
		                            <div class="form-group">
			                            <div class="controls row">                                            
                                                @Html.TextBoxFor(model => model.email, new { @class ="form-control"})                                                                                    
                                                <span>@Html.ValidationMessageFor(model => model.email)</span>	
			                            </div>
		                            </div>
                                </td>
                                <td></td>
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.userid)</label></td>
                                <td>
		                            <div class="form-group">
			                            <div class="controls row">                                            
                                                @Html.TextBoxFor(model => model.userid, new { @class ="form-control"})                                                                                    
                                                <span>@Html.ValidationMessageFor(model => model.userid)</span>	
			                            </div>
		                            </div>
                                </td>
                                <td></td>
                            </tr>
                            <tr>                                
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.Tel)</label></td>
                                <td>
		                            <div class="form-group">
			                            <div class="controls row">                                            
                                                @Html.TextBoxFor(model => model.Tel, new { @class ="form-control"})                                                                                    
                                                <span>@Html.ValidationMessageFor(model => model.Tel)</span>	
			                            </div>
		                            </div>
                                </td>
                                <td></td>
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.password)</label></td>
                                <td>
		                            <div class="form-group">
			                            <div class="controls row">                                            
                                                @Html.PasswordFor(model => model.password, new { @class ="form-control"})                                                                                    
                                                <span>@Html.ValidationMessageFor(model => model.password)</span>	
			                            </div>
		                            </div>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.mobile)</label></td>
                                <td>
		                            <div class="form-group">
			                            <div class="controls row">                                            
                                                @Html.TextBoxFor(model => model.mobile, new { @class ="form-control"})                                                                                    
                                                <span>@Html.ValidationMessageFor(model => model.mobile)</span>	
			                            </div>
		                            </div>
                                </td>
                                <td></td>
                                <td style="width:15%;"><label class="control-label" >@Html.LabelFor(model => model.status)</label></td>
                                <td>
					                <div class="form-group">						                
						                <div class="controls row">                                            
                                            @Html.DropDownListFor(model => model.status, new SelectList(@ViewBag.StatusOptions,"id","status"), new { @class ="form-control"})                                            
                                            @Html.ValidationMessageFor(model => model.status)
						                </div>
					                </div>
                                </td>
                                <td></td>
                            </tr>
                            <tr>
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.address)</label></td>
                                <td colspan ="4">
		                            <div class="form-group">
			                            <div class="controls row">                                            
                                                @Html.TextBoxFor(model => model.address, new { @class ="form-control"})                                                                                    
                                                <span>@Html.ValidationMessageFor(model => model.address)</span>	
			                            </div>
		                            </div>
                                </td>
                            </tr>
                            <tr>
                                <td><label class="control-label" for="input1">@Html.LabelFor(model => model.postalcode)</label></td>
                                <td>
		                            <div class="form-group">
			                            <div class="controls row">                                            
                                                @Html.TextBoxFor(model => model.postalcode, new { @class ="form-control"})                                                                                    
                                                <span>@Html.ValidationMessageFor(model => model.postalcode)</span>	
			                            </div>
		                            </div>
                                </td>
                                <td style="width:10%;"></td>
                                <td>@Html.HiddenFor( model => model.cussuptype)  </td>
                                <td></td>
                                <td></td>
                            </tr>
                            <tr>
                                <td colspan ="6">
		                            <div class="form-actions">
			                            <button type="submit" class="btn btn-primary" value="Save" >Save changes</button>
                                        @*<a class="btn btn-primary" href="@Url.Action("UserSave", "Access", new { id = item.id })" title ="Edit User"></a>*@
			                            <button type="reset" class="btn">Cancel</button>
                                        <a class="btn btn-primary" href="@Url.Action("Index", "CusSup", new  { type = Model.cussuptype})" title ="Go to Listing">Back</a>
		                            </div>
                                </td>     
                            </tr>
                        </table>

           
                    </fieldset>                
                }
            </div> @*box*@
        </div>
    </div>@*row*@

 <div class="row">
    <div class="col-lg-12">					
	<div class="box">
        <div class="box-header" style="background-color:#EEE;"></div>
		<div class="box-content">
                                
			<ul class="nav tab-menu nav-tabs" id="myTab" style ="padding-left:10px;list-style: none;">
				<li id="liInvoices" name="liInvoices" class="active" style ='float: left;' ><a href="#invoice" id ="lnkInvoice">Invoices</a></li>
				<li id="liItems" name="liItems" style ='float: left;'><a href="#item">Items</a></li>
                <li id="liApp" name="liApp"  style ='float: left;' ><a href="#App">Appointment/Reservation</a></li>
                <li id="liTopup" name="liTopup"  style ='float: left;' ><a href="#Topup">Top Up</a></li>							    
			</ul>
                                
			<div id="myTabContent" class="tab-content">
				<div class="tab-pane active" id="invoice">
					<div class="box">
						<div class="box-header" data-original-title>
							<h2><i class="fa fa-dollar"></i><span class="break"></span><span id="invheader"> Invoice List</span></h2>
							<div class="box-icon">
								<a href="#" class="btn-setting"><i class="fa fa-wrench"></i></a>
								<a href="#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
						</div>
						<div class="box-content" id ="bxInvoice">            
                            <div id ="divInvoice">
@*                                <table id ="tblInvoice" class='table table-striped table-bordered bootstrap-datatable datatable'>
                                    <thead>
                                    <tr >
                                    <th style='width:100px;'>Sr.</th>
                                    <th style='width:100px;'>Invoice</th>
                                    <th style='width:100px;'>Create Date</th>
                                    <th style='width:100px;'>Total</th>
                                    <th style='width:100px;'>Currency</th>
                                    </tr>
                                    </thead>
                                    <tbody >

                                    </tbody>
                                </table>*@
                            </div>
                        </div>                         
                    </div>
				</div>
				<div class="tab-pane" id="item">
					<div class="box">
						<div class="box-header" data-original-title>
							<h2><i class="fa fa-dollar"></i><span class="break"></span>Item List</h2>
							<div class="box-icon">
								<a href="#" class="btn-setting"><i class="fa fa-wrench"></i></a>
								<a href="#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
						</div>
						<div class="box-content">            
                            <div id ="divItem"></div>
                        </div>                        
                    </div> 
				</div>
				<div class="tab-pane" id="App">
					<div class="box">
						<div class="box-header" data-original-title>
							<h2><i class="fa fa-dollar"></i><span class="break"></span>Appointment/Reservation List</h2>
							<div class="box-icon">
								<a href="#" class="btn-setting"><i class="fa fa-wrench"></i></a>
								<a href="#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
						</div>
						<div class="box-content">            
                            <div id ="divApp"></div>
                        </div>                        
                    </div>
				</div>
				<div class="tab-pane" id="Topup">
					<div class="box">
						<div class="box-header" data-original-title>
							<h2><i class="fa fa-dollar"></i><span class="break"></span>Top Up List</h2>
							<div class="box-icon">
								<a href="#" class="btn-setting"><i class="fa fa-wrench"></i></a>
								<a href="#" class="btn-minimize"><i class="fa fa-chevron-up"></i></a>
								<a href="#" class="btn-close"><i class="fa fa-times"></i></a>
							</div>
						</div>
						<div class="box-content">            
                            <div id ="divTopup"></div>
                        </div>                        
                    </div>
				</div>
@*
*@


			</div> @*row*@
			</div>
		</div>
	</div><!--/col-->				
</div><!--/row-->

<script type ="text/javascript">
    var ctmp = new Date();
    populateInvoice();
    
    $('#liInvoices').click(function e() { populateInvoice(); });
    $('#liItems').click(function e() { populateItem(); });
    $('#liApp').click(function e() { populateApp(); });
    $('#liTopup').click(function e() { populateTopUp(); });
    if ($('#cussuptype').val() != "Customer")
    {
        // alert('hide');
        $('#lnkInvoice').text("Purchases");
        $('#invheader').text("Purchases List");        
        $('#liApp').remove();
        $('#liTopup').remove();
        //$('#App').attr("Display", "hidden");
        //$('#Topup').hide();
    }
    //$.extend($.fn.dataTableExt.oStdClasses, {
    //    "sWrapper": "dataTables_wrapper form-inline"
    //});

    //$(document).ready(function () {
    //    $('#divInvoice').append(content);
    //    populateInvoice()
    //    $('.table').dataTable({
    //        "sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>"
    //    });
    //});

    function populateInvoice()
    {
        var cid = $('#id').val();;
        
        $.ajax({
            url: '@Url.Action("getCustInvoices", "CusSup")',
            data: { cussupid: cid },
            type: 'POST',
            success: function (data) {
                //var Htmlstr = "";
                var Htmlstr = "<table class='table table-striped table-bordered bootstrap-datatable datatable'><thead>";
                //var Htmlstr = "<thead>";
                var closeHtml = "</tbody></table>";
                var tmpstr = "";
                Htmlstr = Htmlstr + "<tr ><th style='width:100px;'>Sr.</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Invoice</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Create Date</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Total</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Currency</th>";
                Htmlstr = Htmlstr + "</tr></thead><tbody>";
                //var rows = "";
                for (var x = 0; x < data.length; x++) {
                    ctmp = getDateFromAspString(data[x].createdate);
                    //alert(data[x].createdate + "," + ctmp + "," + ctmp.getFullYear());
                    Htmlstr += "<tr id='" + data[x].id + "'><td>" + (x + 1) + "</td><td >" + data[x].resourcecode + "</td>" + "<td >" + ctmp.getDate() + "/" + (ctmp.getMonth() + 1) + "/" + ctmp.getFullYear() + "</td>" + "<td >" + data[x].total_total + "</td>" + "<td >" + data[x].currency + "</td></tr>";
                }
                Htmlstr += closeHtml;

                $('#divInvoice').html(Htmlstr);
                //$('#tblInvoice').html(Htmlstr); 
                //$('#tblInvoice').append(rows);
                
                //$(rows).appendTo($('#tblInvoice'));
                //$('#bxInvoice').ready();
                //$('#divInvoice').append(Htmlstr);

                $('#divInvoice table').last().dataTable({
                    //"sDom": "<'row'<'span6'l><'span6'f>r>t<'row'<'span6'i><'span6'p>>"
                });	
            },
            error: function (ts) { alert(ts.responseText) }
        });
    }

    function populateItem()
    {
        var cid = $('#id').val();;

        $.ajax({
            url: '@Url.Action("getCustitems", "CusSup")',
            data: { cussupid: cid },
            type: 'POST',
            success: function (data) {
                
                var Htmlstr = "<table class='table table-striped table-bordered bootstrap-datatable datatable'><thead>";                
                var closeHtml = "</tbody></table>";
                var tmpstr = "";
                Htmlstr = Htmlstr + "<tr ><th style='width:100px;'>Sr.</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Invoice</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Product Code</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Description</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Quantity</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Unit Price</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Discount</th>";
                Htmlstr = Htmlstr + "</tr></thead><tbody>";
                //var rows = "";
                for (var x = 0; x < data.length; x++) {

                    Htmlstr += "<tr id='" + data[x].id + "'><td>" + (x + 1) + "</td><td >" + data[x].resourcecode + "</td>" + "<td >" + data[x].productcode + "</td>" + "<td >" + data[x].productdesc + "</td>" + "<td >" + data[x].qty + " " + data[x].uom + "</td><td>" + data[x].unitprice + "</td><td>" + data[x].discountamount + "</td></tr>";
                }
                Htmlstr += closeHtml;
                $('#divItem').html(Htmlstr);
                $('#divItem table').last().dataTable({ });
            },
            error: function (ts) { alert(ts.responseText) }
        });
    }

    function populateApp()
    {
        var cid = $('#id').val();;

        $.ajax({
            url: '@Url.Action("getCustApp", "CusSup")',
            data: { cussupid: cid },
            type: 'POST',
            success: function (data) {
                var Htmlstr = "<table class='table table-striped table-bordered bootstrap-datatable datatable'><thead>";
                var closeHtml = "</tbody></table>";
                var tmpstr = "";
                Htmlstr = Htmlstr + "<tr ><th style='width:100px;'>Sr.</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Date</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Time</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Staff</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Description</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Remarks</th>";
                //Htmlstr = Htmlstr + "<th style='width:100px;'></th>";
                Htmlstr = Htmlstr + "</tr></thead><tbody>";
                //var rows = "";
                for (var x = 0; x < data.length; x++) {

                    ctmp = getDateFromAspString(data[x].appointmentdate);                    
                    var dd = data[x].appointmenttime;
                    var h = "";
                    if (dd.Hours < 10)
                        h = "0" + dd.Hours;
                    else
                        h = dd.Hours;
                    var m = "";
                    if (dd.Minutes < 10) m = "0" + dd.Minutes;
                    else m = dd.Minutes;
                    
                    Htmlstr += "<tr id='" + data[x].id + "'><td>" + (x + 1) + "</td><td >" + ctmp.getDate() + "/" + (ctmp.getMonth() + 1) + "/" + ctmp.getFullYear() + "</td>" + "<td >" + h + ":" + m + "</td>" + "<td >" + data[x].Staff.name + "</td>" + "<td >" + data[x].productdesc + "</td><td>" + data[x].remarks + "</td></tr>";
                }
                Htmlstr += closeHtml;
                $('#divApp').html(Htmlstr);
                $('#divApp table').last().dataTable({});
            },
            error: function (ts) { alert(ts.responseText) }
        });
    }

    function populateTopUp()
    {
        var cid = $('#id').val();;

        $.ajax({
            url: '@Url.Action("getCustTopUp", "CusSup")',
            data: { cussupid: cid },
            type: 'POST',
            success: function (data) {
                var Htmlstr = "<table class='table table-striped table-bordered bootstrap-datatable datatable'><thead>";
                var closeHtml = "</tbody></table>";
                var tmpstr = "";
                Htmlstr = Htmlstr + "<tr ><th style='width:100px;'>Sr.</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Ref:</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Date</th>";
                Htmlstr = Htmlstr + "<th style='width:100px;'>Amount</th>";
                Htmlstr = Htmlstr + "</tr></thead><tbody>";
                //var rows = "";
                for (var x = 0; x < data.length; x++) {
                    ctmp = getDateFromAspString(data[x].createdate);
                    Htmlstr += "<tr id='" + data[x].id + "'><td>" + (x + 1) + "</td><td >" + data[x].resourcecode + "</td>" + "<td >" + ctmp.getDate() + "/" + (ctmp.getMonth() + 1) + "/" + ctmp.getFullYear() + "</td>" + "<td >" + data[x].total_total + "</td></tr>";
                }
                Htmlstr += closeHtml;
                $('#divTopup').html(Htmlstr);
                $('#divTopup table').last().dataTable({});
            },
            error: function (ts) { alert(ts.responseText) }
        });
    }

</script>


@section Scripts {
    @Scripts.Render("~/bundles/jqueryval")
}

